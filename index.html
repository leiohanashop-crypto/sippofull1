<!DOCTYPE html> <html lang="ja"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>sippofull - ãƒ¬ã‚¤ã‚ªãƒãƒŠãŠå•åˆã›å¯¾å¿œ</title> <!-- React & ReactDOM --> <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script> <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script> <!-- Babel --> <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script> <!-- Tailwind CSS --> <script src="https://cdn.tailwindcss.com"></script> <!-- Lucide Icons --> <script src="https://unpkg.com/lucide@latest"></script> <!-- Google Fonts --> <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet"> <!-- Firebase SDKs --> <script type="module"> import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"; import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"; import { getFirestore, collection, doc, setDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js"; // Global export for React component usage window.firebaseModules = { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, getFirestore, collection, doc, setDoc, onSnapshot, query }; </script> <style> body { font-family: 'Zen Maru Gothic', sans-serif; background-color: #fdfbf7; } .scrollbar-hide::-webkit-scrollbar { display: none; } .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; } @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } } .animate-bounce-custom { animation: bounce 1s infinite; } @keyframes pulse-ring { 0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(249, 115, 22, 0); } 100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); } } .animate-pulse-ring { animation: pulse-ring 2s infinite; } .delay-100 { animation-delay: 0.1s; } .delay-200 { animation-delay: 0.2s; } /* Custom scrollbar */ .custom-scroll::-webkit-scrollbar { width: 8px; } .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; } .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; } .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; } .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; } @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } } </style> </head> <body> <div id="root"></div> <script type="text/babel"> const { useState, useEffect, useRef } = React; const apiKey = ""; const MODEL_NAME = "gemini-2.5-flash-preview-09-2025"; // â˜…â˜…â˜… æ›´æ–°æ¸ˆã¿LINEãƒªãƒ³ã‚¯ â˜…â˜…â˜… const LINE_URL = "https://lin.ee/BGU2mRL"; const ADMIN_PASS = "admin"; // --- Data Definitions --- const NG_FOODS = [ { id: 'onion', name: 'ãƒã‚®é¡ãƒ»ç‰ã­ã', emoji: 'ğŸ§…', severity: 'high', target: 'both', reason: 'èµ¤è¡€çƒã‚’ç ´å£Šã—ã€è²§è¡€ã‚„è¡€å°¿ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚åŠ ç†±ã—ã¦ã‚‚æ¯’æ€§ã¯æ¶ˆãˆã¾ã›ã‚“ã€‚ãƒãƒ³ãƒãƒ¼ã‚°ã‚„ã‚¹ãƒ¼ãƒ—ã‚‚å±é™ºã§ã™ã€‚', tags: ['è²§è¡€', 'è¡€å°¿'] }, { id: 'lily', name: 'ãƒ¦ãƒªç§‘ã®æ¤ç‰©', emoji: 'ğŸŒº', severity: 'high', target: 'cat', reason: 'çŒ«ã«ã¨ã£ã¦çŒ›æ¯’ã€‚èŠ±ç²‰ã€èŠ±ç“¶ã®æ°´ã€è‘‰ã®ã²ã¨ã‹ã˜ã‚Šã§æ€¥æ€§è…ä¸å…¨ã‚’èµ·ã“ã—ã€æ•°æ—¥ã§æ­»ã«è‡³ã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚', tags: ['è…ä¸å…¨', 'å³æ­»'] }, { id: 'chocolate', name: 'ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ', emoji: 'ğŸ«', severity: 'high', target: 'both', reason: 'ã€Œãƒ†ã‚ªãƒ–ãƒ­ãƒŸãƒ³ã€ãŒåŸå› ã§ã€å˜”åã€ä¸‹ç—¢ã€ç—™æ”£ã€ä¸æ•´è„ˆã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ã‚«ã‚«ã‚ªå«æœ‰é‡ãŒé«˜ã„ã»ã©å±é™ºã§ã™ã€‚', tags: ['ä¸­æ¯’', 'å¿ƒè‡“'] }, { id: 'grape', name: 'ã¶ã©ã†ãƒ»ãƒ¬ãƒ¼ã‚ºãƒ³', emoji: 'ğŸ‡', severity: 'high', target: 'dog', reason: 'çŠ¬ã§æ€¥æ€§è…ä¸å…¨ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚çš®ã‚‚å®Ÿã‚‚NGã€‚çŒ«ã¸ã®å½±éŸ¿ã¯ä¸æ˜ç¢ºã§ã™ãŒé¿ã‘ãŸã»ã†ãŒç„¡é›£ã§ã™ã€‚', tags: ['è…ä¸å…¨', 'å˜”å'] }, { id: 'xylitol', name: 'ã‚­ã‚·ãƒªãƒˆãƒ¼ãƒ«', emoji: 'ğŸ¬', severity: 'high', target: 'dog', reason: 'ã‚¬ãƒ ãªã©ã«å«ã¾ã‚Œã¾ã™ã€‚çŠ¬ã¯æ€¥æ¿€ãªä½è¡€ç³–ã‚’å¼•ãèµ·ã“ã—ã€è‚ä¸å…¨ã«ãªã‚‹æã‚ŒãŒã‚ã‚Šã¾ã™ã€‚å°‘é‡ã§ã‚‚éå¸¸ã«å±é™ºã§ã™ã€‚', tags: ['ä½è¡€ç³–', 'è‚ä¸å…¨'] }, { id: 'medicine', name: 'äººé–“ç”¨ã®è–¬', emoji: 'ğŸ’Š', severity: 'high', target: 'both', reason: 'ç‰¹ã«é¢¨é‚ªè–¬ç­‰ã®ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³ã¯çŒ«ã«çŒ›æ¯’ï¼ˆè¡€æ¶²ã®é…¸ç´ é‹æ¬èƒ½åŠ›å–ªå¤±ï¼‰ã€‚çŠ¬ã‚‚ä¸­æ¯’ã‚’èµ·ã“ã—ã¾ã™ã€‚', tags: ['å‘¼å¸å›°é›£', 'ãƒã‚¢ãƒãƒ¼ã‚¼'] }, { id: 'alcohol', name: 'ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«', emoji: 'ğŸº', severity: 'high', target: 'both', reason: 'åˆ†è§£ã§ããšã€æ˜ç¡çŠ¶æ…‹ã‚„å‘¼å¸åœæ­¢ã«é™¥ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ç”Ÿãƒ‘ãƒ³ç”Ÿåœ°ã®ç™ºé…µã«ã‚ˆã‚‹ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ç”Ÿæˆã‚‚å±é™ºã§ã™ã€‚', tags: ['æ˜ç¡', 'å‘¼å¸åœæ­¢'] }, { id: 'aroma', name: 'ã‚¢ãƒ­ãƒãƒ»ç²¾æ²¹', emoji: 'ğŸŒ¿', severity: 'high', target: 'cat', reason: 'çŒ«ã¯è‚è‡“ã§æ¤ç‰©æˆåˆ†ã‚’åˆ†è§£ã§ãã¾ã›ã‚“ã€‚ãƒ†ã‚£ãƒ¼ãƒ„ãƒªãƒ¼ãªã©ã¯çš®è†šã‹ã‚‰ã‚‚å¸åã•ã‚Œä¸­æ¯’ã‚’èµ·ã“ã—ã¾ã™ã€‚', tags: ['è‚éšœå®³', 'ç¥çµŒç—‡çŠ¶'] }, { id: 'avocado', name: 'ã‚¢ãƒœã‚«ãƒ‰', emoji: 'ğŸ¥‘', severity: 'medium', target: 'both', reason: 'ã€Œãƒšãƒ«ã‚·ãƒ³ã€ã¨ã„ã†æˆåˆ†ãŒä¸­æ¯’ç—‡çŠ¶ï¼ˆå˜”åãƒ»ä¸‹ç—¢ï¼‰ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚ç¨®ã‚’é£²ã¿è¾¼ã‚“ã§è…¸é–‰å¡ã«ãªã‚‹äº‹æ•…ã‚‚å¤šã„ã§ã™ã€‚', tags: ['å˜”å', 'ä¸‹ç—¢'] }, { id: 'bone', name: 'åŠ ç†±ã—ãŸéª¨', emoji: 'ğŸ–', severity: 'medium', target: 'both', reason: 'åŠ ç†±ã—ãŸé¶ã®éª¨ãªã©ã¯ç¸¦ã«é‹­ãå‰²ã‚Œã‚„ã™ãã€é£Ÿé“ã‚„èƒƒè…¸ã‚’çªãåˆºã™å±é™ºãŒã‚ã‚Šã¾ã™ã€‚ã‚ã’ã‚‹ãªã‚‰ã€Œç”Ÿã€ã‹ã€Œå°‚ç”¨ãŠã‚„ã¤ã€ã‚’ã€‚', tags: ['èª¤é£²', 'è£‚å‚·'] }, { id: 'caffeine', name: 'ã‚«ãƒ•ã‚§ã‚¤ãƒ³', emoji: 'â˜•', severity: 'medium', target: 'both', reason: 'ã‚³ãƒ¼ãƒ’ãƒ¼ã€ç´…èŒ¶ã€ç·‘èŒ¶ãªã©ã€‚èˆˆå¥®çŠ¶æ…‹ã€å‘¼å¸ãƒ»å¿ƒæ‹æ•°ã®å¢—åŠ ã€ç—™æ”£ãªã©ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚', tags: ['ç—™æ”£', 'ä¸æ•´è„ˆ'] }, { id: 'nuts', name: 'ãƒã‚«ãƒ€ãƒŸã‚¢ãƒŠãƒƒãƒ„', emoji: 'ğŸ¥œ', severity: 'medium', target: 'dog', reason: 'çŠ¬ã§å¾Œã‚è¶³ã®éº»ç—ºã€å˜”åã€ç™ºç†±ãªã©ã‚’å¼•ãèµ·ã“ã™ä¸­æ¯’ç—‡çŠ¶ãŒå ±å‘Šã•ã‚Œã¦ã„ã¾ã™ã€‚', tags: ['éº»ç—º', 'ç™ºç†±'] }, { id: 'seafood', name: 'ã‚¤ã‚«ãƒ»ã‚¿ã‚³ãƒ»ã‚«ãƒ‹', emoji: 'ğŸ¦‘', severity: 'low', target: 'both', reason: 'æ¶ˆåŒ–ãŒæ‚ªãä¸‹ç—¢ã®åŸå› ã«ã€‚ç”Ÿã®é­šä»‹é¡ã¯ãƒ“ã‚¿ãƒŸãƒ³B1æ¬ ä¹ç—‡ï¼ˆçŒ«ã®è…°æŠœã‘ï¼‰ã®ãƒªã‚¹ã‚¯ã‚‚ã‚ã‚Šã¾ã™ã€‚', tags: ['æ¶ˆåŒ–ä¸è‰¯', 'ãƒ“ã‚¿ãƒŸãƒ³æ¬ ä¹'] }, { id: 'spices', name: 'é¦™è¾›æ–™', emoji: 'ğŸŒ¶ï¸', severity: 'low', target: 'both', reason: 'èƒƒè…¸ã‚’åˆºæ¿€ã—ã€ä¸‹ç—¢ã‚„å˜”åã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚æ„Ÿè¦šéº»ç—ºã‚„è‚è‡“ã¸ã®è² æ‹…ã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚', tags: ['èƒƒè…¸ç‚'] }, { id: 'milk', name: 'äººé–“ç”¨ã®ç‰›ä¹³', emoji: 'ğŸ¥›', severity: 'low', target: 'both', reason: 'ã€Œä¹³ç³–ã€ã‚’åˆ†è§£ã§ããšã€ä¸‹ç—¢ã‚’ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚ãƒ¤ã‚®ãƒŸãƒ«ã‚¯ã‚„ãƒšãƒƒãƒˆç”¨ç‰›ä¹³ã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚', tags: ['ä¸‹ç—¢'] } ]; const PET_TYPES = [ { id: 'dog', label: 'ã‚ã‚“ã¡ã‚ƒã‚“', icon: 'dog' }, { id: 'cat', label: 'ã­ã“ã¡ã‚ƒã‚“', icon: 'cat' } ]; const BREEDS = { dog: [ 'ãƒŸãƒƒã‚¯ã‚¹ï¼ˆé›‘ç¨®ï¼‰', 'ç§‹ç”°çŠ¬', 'ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ»ã‚°ãƒ¬ãƒ¼ãƒã‚¦ãƒ³ãƒ‰', 'ã‚¦ã‚§ãƒ«ã‚·ãƒ¥ãƒ»ã‚³ãƒ¼ã‚®ãƒ¼', 'ã‚«ãƒ‹ãƒ˜ãƒ³ãƒ»ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰', 'ã‚­ãƒ£ãƒãƒªã‚¢', 'ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ»ãƒ¬ãƒˆãƒªãƒãƒ¼', 'ã‚·ãƒ¼ã‚ºãƒ¼', 'ã‚·ã‚§ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°', 'æŸ´çŠ¬', 'ã‚¸ãƒ£ãƒƒã‚¯ãƒ»ãƒ©ãƒƒã‚»ãƒ«ãƒ»ãƒ†ãƒªã‚¢', 'ã‚·ãƒ¥ãƒŠã‚¦ã‚¶ãƒ¼', 'ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«', 'ã‚¹ãƒ”ãƒƒãƒ„', 'ã‚»ãƒ³ãƒˆãƒ»ãƒãƒ¼ãƒŠãƒ¼ãƒ‰', 'ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰ï¼ˆãƒŸãƒ‹ãƒãƒ¥ã‚¢ï¼‰', 'ãƒãƒ¯ãƒ¯', 'ãƒˆã‚¤ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«', 'ãƒ‰ãƒ¼ãƒ™ãƒ«ãƒãƒ³', 'ãƒ‘ã‚°', 'ãƒã‚¹ã‚­ãƒ¼', 'ãƒ‘ãƒ”ãƒ¨ãƒ³', 'ãƒ“ãƒ¼ã‚°ãƒ«', 'ãƒ“ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ãƒªãƒ¼ã‚¼', 'ãƒ–ãƒ«ãƒ‰ãƒƒã‚°', 'ãƒ•ãƒ¬ãƒ³ãƒãƒ»ãƒ–ãƒ«ãƒ‰ãƒƒã‚°', 'ãƒšã‚­ãƒ‹ãƒ¼ã‚º', 'ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»ã‚³ãƒªãƒ¼', 'ãƒãƒ¡ãƒ©ãƒ‹ã‚¢ãƒ³', 'ãƒœã‚¹ãƒˆãƒ³ãƒ»ãƒ†ãƒªã‚¢', 'ãƒãƒ«ãƒãƒ¼ã‚º', 'ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«', 'ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ã‚·ãƒ¥ãƒŠã‚¦ã‚¶ãƒ¼', 'ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ãƒ”ãƒ³ã‚·ãƒ£ãƒ¼', 'ãƒ¨ãƒ¼ã‚¯ã‚·ãƒ£ãƒ¼ãƒ»ãƒ†ãƒªã‚¢', 'ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ»ãƒ¬ãƒˆãƒªãƒãƒ¼', 'ãƒ¯ã‚¤ãƒãƒ©ãƒŠãƒ¼', 'ãã®ä»–' ], cat: [ 'ãƒŸãƒƒã‚¯ã‚¹ï¼ˆé›‘ç¨®ï¼‰', 'ã‚¢ãƒ“ã‚·ãƒ‹ã‚¢ãƒ³', 'ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆãƒ˜ã‚¢', 'ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ã‚«ãƒ¼ãƒ«', 'ã‚¨ã‚­ã‚¾ãƒãƒƒã‚¯ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆãƒ˜ã‚¢', 'ã‚µã‚¤ãƒ™ãƒªã‚¢ãƒ³', 'ã‚·ãƒ£ãƒ ', 'ã‚·ãƒ£ãƒ«ãƒˆãƒªãƒ¥ãƒ¼', 'ã‚·ãƒ³ã‚¬ãƒ—ãƒ¼ãƒ©', 'ã‚¹ã‚³ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰', 'ã‚¹ãƒ•ã‚£ãƒ³ã‚¯ã‚¹', 'ã‚½ãƒãƒª', 'ãƒˆãƒ³ã‚­ãƒ‹ãƒ¼ã‚º', 'ãƒãƒ«ã‚¦ã‚§ãƒ¼ã‚¸ãƒ£ãƒ³ãƒ»ãƒ•ã‚©ãƒ¬ã‚¹ãƒˆãƒ»ã‚­ãƒ£ãƒƒãƒˆ', 'ãƒãƒ¼ãƒŸãƒ¼ã‚º', 'ãƒ’ãƒãƒ©ãƒ¤ãƒ³', 'ãƒ–ãƒªãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆãƒ˜ã‚¢', 'ãƒšãƒ«ã‚·ãƒ£', 'ãƒ™ãƒ³ã‚¬ãƒ«', 'ãƒœãƒ³ãƒ™ã‚¤', 'ãƒãƒ³ãƒã‚«ãƒ³', 'ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ¼ãƒ³', 'ãƒ©ã‚°ãƒ‰ãƒ¼ãƒ«', 'ãƒ©ã‚¬ãƒãƒ•ã‚£ãƒ³', 'ãƒ­ã‚·ã‚¢ãƒ³ãƒ–ãƒ«ãƒ¼', 'æ—¥æœ¬çŒ«', 'ãã®ä»–' ] }; const AGES = [ { id: 'baby', label: 'ãƒ‘ãƒ”ãƒ¼/ã‚­ãƒˆãƒ³', sub: '1æ­³æœªæº€' }, { id: 'adult', label: 'æˆçŠ¬/æˆçŒ«', sub: '1ã€œ6æ­³' }, { id: 'senior', label: 'ã‚·ãƒ‹ã‚¢', sub: '7æ­³ä»¥ä¸Š' } ]; const TOPICS = [ { id: 'eat_uneven', label: 'é£Ÿã¹ãƒ ãƒ©ãŒã‚ã‚‹', query: 'ã”é£¯ã‚’é£Ÿã¹ãŸã‚Šé£Ÿã¹ãªã‹ã£ãŸã‚Šã™ã‚‹ã€Œé£Ÿã¹ãƒ ãƒ©ã€ãŒã‚ã‚Šã¾ã™ã€‚åŸå› ã¨å¯¾ç­–ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚' }, { id: 'bored_food', label: 'ã”é£¯ã«é£½ããŸ', query: 'ã„ã¤ã‚‚ã®ãƒ•ãƒ¼ãƒ‰ã«é£½ãã¦ã—ã¾ã£ãŸã‚ˆã†ã§ã™ã€‚é£Ÿã„ã¤ãã‚’è‰¯ãã™ã‚‹å·¥å¤«ã‚„ã€åˆ‡ã‚Šæ›¿ãˆæ–¹ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚' }, { id: 'allergy', label: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®æ‚©ã¿', query: 'é£Ÿç‰©ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒå¿ƒé…ã§ã™ã€‚ç—‡çŠ¶ã®è¦‹åˆ†ã‘æ–¹ã‚„ã€ãƒ•ãƒ¼ãƒ‰é¸ã³ã®ãƒã‚¤ãƒ³ãƒˆã‚’æ•™ãˆã¦ãã ã•ã„ã€‚' }, { id: 'food_amount', label: 'ãƒ•ãƒ¼ãƒ‰ã®ä¸ãˆæ–¹', query: 'æ­£ã—ã„ãƒ•ãƒ¼ãƒ‰ã®é‡ã‚„å›æ•°ã€ä¸ãˆæ–¹ã®åŸºæœ¬ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚' }, { id: 'diet', label: 'ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ»å¥åº·', query: 'å°‘ã—å¤ªã‚Šæ°—å‘³ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚å¥åº·çš„ãªãƒ€ã‚¤ã‚¨ãƒƒãƒˆæ–¹æ³•ã‚„é£Ÿäº‹ç®¡ç†ã«ã¤ã„ã¦æ•™ãˆã¦ãã ã•ã„ã€‚' }, { id: 'trouble', label: 'èª¤é£Ÿãƒ»ãƒˆãƒ©ãƒ–ãƒ«', query: 'é£Ÿã¹ã¦ã¯ã„ã‘ãªã„ã‚‚ã®ã‚’é£Ÿã¹ã¦ã—ã¾ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿï¼ˆç·Šæ€¥æ€§ã®é«˜ã„å›ç­”ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼‰' } ]; // --- Firebase Integration Hooks --- const useFirebase = () => { const [db, setDb] = useState(null); const [user, setUser] = useState(null); const [appId, setAppId] = useState(null); const [auth, setAuth] = useState(null); useEffect(() => { const initFirebase = async () => { // Wait for modules to be loaded (Race condition protection) let retries = 0; while (!window.firebaseModules && retries < 20) { await new Promise(resolve => setTimeout(resolve, 100)); retries++; } if (!window.firebaseModules) { console.error("Firebase modules failed to load."); return; } const { initializeApp, getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken, getFirestore } = window.firebaseModules; try { const configStr = typeof __firebase_config !== 'undefined' ? __firebase_config : null; if (!configStr) { console.warn("No firebase config found. Running in offline/demo mode."); return; } const firebaseConfig = JSON.parse(configStr); const app = initializeApp(firebaseConfig); const authInstance = getAuth(app); const firestore = getFirestore(app); setDb(firestore); setAuth(authInstance); setAppId(typeof __app_id !== 'undefined' ? __app_id : 'default-app-id'); // Auth Logic if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) { await signInWithCustomToken(authInstance, __initial_auth_token); } else { await signInAnonymously(authInstance); } const unsubscribe = onAuthStateChanged(authInstance, setUser); return () => unsubscribe(); } catch (e) { console.error("Firebase init error:", e); } }; initFirebase(); }, []); return { db, user, appId, auth }; }; const useShopComments = (db, user, appId) => { const [comments, setComments] = useState({}); useEffect(() => { if (!db || !user || !appId) return; const { collection, onSnapshot } = window.firebaseModules; // RULE 1 Strict path const colRef = collection(db, 'artifacts', appId, 'public', 'data', 'shop_comments'); // onSnapshot with error callback const unsubscribe = onSnapshot(colRef, (snapshot) => { const data = {}; snapshot.forEach(doc => { data[doc.id] = doc.data().text; }); setComments(data); }, (error) => { console.error("Error fetching comments:", error); }); return () => unsubscribe(); }, [db, user, appId]); const saveComment = async (topicId, text) => { if (!db || !appId) return; const { doc, setDoc } = window.firebaseModules; const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'shop_comments', topicId); await setDoc(docRef, { text }); }; return { comments, saveComment }; }; // --- Components --- // NG Food Modal Component const NgFoodModal = ({ isOpen, onClose, defaultFilter = 'all' }) => { const [filter, setFilter] = useState('all'); // Reset filter when opened useEffect(() => { if (isOpen) setFilter(defaultFilter); }, [isOpen, defaultFilter]); if (!isOpen) return null; const filteredFoods = NG_FOODS.filter(item => { if (filter === 'all') return true; if (filter === 'dog') return item.target === 'dog' || item.target === 'both'; if (filter === 'cat') return item.target === 'cat' || item.target === 'both'; return true; }); // Helper to render target badge const TargetBadge = ({ target }) => { if (target === 'both') return ( <span className="flex gap-1 items-center bg-purple-100 text-purple-700 px-2 py-0.5 rounded-full text-[10px] font-bold border border-purple-200"> <i data-lucide="dog" className="w-3 h-3"></i> <i data-lucide="cat" className="w-3 h-3"></i> ä¸¡æ–¹æ³¨æ„ </span> ); if (target === 'dog') return ( <span className="flex gap-1 items-center bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-[10px] font-bold border border-blue-200"> <i data-lucide="dog" className="w-3 h-3"></i> çŠ¬ã«å±é™º </span> ); if (target === 'cat') return ( <span className="flex gap-1 items-center bg-pink-100 text-pink-700 px-2 py-0.5 rounded-full text-[10px] font-bold border border-pink-200"> <i data-lucide="cat" className="w-3 h-3"></i> çŒ«ã«å±é™º </span> ); return null; }; return ( <div className="fixed inset-0 bg-black/60 z-[70] flex items-center justify-center p-4 animate-fade-in backdrop-blur-sm"> <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl relative"> <div className="bg-red-500 text-white p-4 flex justify-between items-center shadow-md shrink-0"> <h3 className="font-bold text-lg flex items-center gap-2"> <i data-lucide="triangle-alert" className="w-6 h-6 fill-yellow-400 text-red-600"></i> é£Ÿã¹ã¦ã¯ã„ã‘ãªã„ã‚‚ã® </h3> <button onClick={onClose} className="hover:bg-red-600 p-1 rounded-full transition-colors"> <i data-lucide="x" className="w-7 h-7"></i> </button> </div> {/* Filter Tabs */} <div className="bg-red-50 p-2 flex gap-2 justify-center border-b border-red-100 shrink-0"> <button onClick={() => setFilter('all')} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1 ${ filter === 'all' ? 'bg-white text-red-600 shadow-sm border border-red-100' : 'text-gray-500 hover:bg-white/50' }`} > <span className="text-lg">ğŸ¾</span> ã™ã¹ã¦ </button> <button onClick={() => setFilter('dog')} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1 ${ filter === 'dog' ? 'bg-white text-blue-600 shadow-sm border border-blue-100' : 'text-gray-500 hover:bg-white/50' }`} > <i data-lucide="dog" className="w-4 h-4"></i> çŠ¬ </button> <button onClick={() => setFilter('cat')} className={`flex-1 py-2 px-4 rounded-lg text-sm font-bold transition-all flex items-center justify-center gap-1 ${ filter === 'cat' ? 'bg-white text-pink-600 shadow-sm border border-pink-100' : 'text-gray-500 hover:bg-white/50' }`} > <i data-lucide="cat" className="w-4 h-4"></i> çŒ« </button> </div> <div className="p-4 overflow-y-auto flex-1 custom-scroll bg-gray-50 pb-20"> <div className="bg-white p-4 rounded-xl border border-red-200 mb-4 text-sm shadow-sm"> <p className="font-bold text-red-600 mb-1">ğŸš‘ ã‚‚ã—é£Ÿã¹ã¦ã—ã¾ã£ãŸã‚‰ï¼Ÿ</p> <p className="text-gray-700 leading-relaxed"> è‡ªå·±åˆ¤æ–­ã§åã‹ã›ã‚‹ã®ã¯å±é™ºã§ã™ã€‚ <br/> <strong>ã€Œä½•ã‚’ã€ã€Œã„ã¤ã€ã€Œã©ã®ãã‚‰ã„ã€</strong>é£Ÿã¹ãŸã‹ã‚’ãƒ¡ãƒ¢ã—ã¦ã€ã™ãã«å‹•ç‰©ç—…é™¢ã¸é€£çµ¡ã—ã¦ãã ã•ã„ã€‚ </p> </div> <div className="grid grid-cols-1 sm:grid-cols-2 gap-4"> {filteredFoods.map(item => ( <div key={item.id} className="bg-white rounded-xl p-4 shadow-sm border border-gray-100 relative overflow-hidden group hover:shadow-md transition-shadow"> <div className={`absolute top-0 left-0 w-1.5 h-full ${item.severity === 'high' ? 'bg-red-500' : 'bg-orange-400'}`}></div> <div className="pl-3"> <div className="flex justify-between items-start mb-2"> <div className="flex items-center gap-3 w-full"> <span className="text-4xl filter drop-shadow-sm">{item.emoji}</span> <div className="flex-1"> <div className="flex justify-between items-start"> <h4 className="font-bold text-gray-800 text-lg leading-tight">{item.name}</h4> <TargetBadge target={item.target} /> </div> {item.severity === 'high' && ( <span className="text-[10px] bg-red-100 text-red-600 px-2 py-0.5 rounded-full font-bold inline-block mt-1"> å‘½ã®å±é™ºã‚ã‚Š </span> )} </div> </div> </div> <p className="text-sm text-gray-600 leading-relaxed mb-3"> {item.reason} </p> <div className="flex flex-wrap gap-1"> {item.tags.map(tag => ( <span key={tag} className="text-xs bg-gray-100 text-gray-500 px-2 py-1 rounded-md"> #{tag} </span> ))} </div> </div> </div> ))} </div> </div> {/* Bottom Close Button */} <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-white via-white to-transparent p-4 pt-8"> <button onClick={onClose} className="w-full bg-gray-800 text-white py-3 rounded-xl font-bold hover:bg-gray-900 transition-colors shadow-lg flex items-center justify-center gap-2" > <i data-lucide="x" className="w-5 h-5"></i> é–‰ã˜ã‚‹ </button> </div> </div> </div> ); }; const AdminModal = ({ isOpen, onClose, comments, onSave }) => { const [password, setPassword] = useState(""); const [isAuthenticated, setIsAuthenticated] = useState(false); const [editValues, setEditValues] = useState({}); // ä¿®æ­£: ç·¨é›†ä¸­ã®å€¤(prev)ã‚’å„ªå…ˆã—ã€DBã‹ã‚‰ã®æ›´æ–°(comments)ã§ä¸Šæ›¸ãã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ useEffect(() => { if (isOpen && comments) { setEditValues(prev => ({ ...comments, ...prev })); } }, [isOpen, comments]); const handleLogin = () => { if (password === ADMIN_PASS) { setIsAuthenticated(true); } else { alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™"); } }; const handleSave = async (topicId) => { try { await onSave(topicId, editValues[topicId] || ""); alert("ä¿å­˜ã—ã¾ã—ãŸ"); } catch (e) { console.error("ä¿å­˜ã‚¨ãƒ©ãƒ¼:", e); alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"); } }; if (!isOpen) return null; return ( <div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4"> <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col shadow-2xl relative"> <div className="bg-orange-500 text-white p-4 flex justify-between items-center"> <h3 className="font-bold text-lg flex items-center gap-2"> <i data-lucide="settings" className="w-5 h-5"></i> {isAuthenticated ? "åº—é•·ã‚³ãƒ¡ãƒ³ãƒˆç·¨é›†" : "ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³"} </h3> <button onClick={onClose} className="hover:bg-orange-600 p-1 rounded-full"> <i data-lucide="x" className="w-6 h-6"></i> </button> </div> <div className="p-6 overflow-y-auto flex-1 custom-scroll pb-20"> {!isAuthenticated ? ( <div className="flex flex-col gap-4 items-center justify-center py-8"> <p className="text-gray-600">ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p> <input type="password" className="border border-gray-300 rounded-lg px-4 py-2 w-64 text-center text-lg" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰" /> <button onClick={handleLogin} className="bg-orange-500 text-white px-6 py-2 rounded-lg font-bold hover:bg-orange-600 transition-colors" > ãƒ­ã‚°ã‚¤ãƒ³ </button> </div> ) : ( <div className="space-y-6"> <div className="bg-blue-50 p-4 rounded-lg text-sm text-blue-800 border border-blue-100"> <p className="font-bold mb-1">ğŸ’¡ ãƒ’ãƒ³ãƒˆ</p> <p>ã“ã“ã«å…¥åŠ›ã—ãŸå†…å®¹ã¯ã€ãŠå®¢æ§˜ãŒãã®ãƒˆãƒ”ãƒƒã‚¯ã‚’é¸ã‚“ã éš›ã€AIã®å›ç­”ã®ä¸‹ã«ã€Œãƒ¬ã‚¤ã‚ªãƒãƒŠåº—é•·ã‚ˆã‚Šã€ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p> </div> {TOPICS.map(topic => ( <div key={topic.id} className="border border-gray-200 rounded-xl p-4 bg-gray-50"> <div className="flex justify-between items-center mb-2"> <h4 className="font-bold text-gray-700">ã€{topic.label}ã€‘</h4> <button onClick={() => handleSave(topic.id)} className="bg-green-500 text-white text-xs px-3 py-1.5 rounded-md hover:bg-green-600 font-bold flex items-center gap-1" > <i data-lucide="save" className="w-3 h-3"></i> ä¿å­˜ </button> </div> <textarea value={editValues[topic.id] || ""} onChange={(e) => setEditValues(prev => ({...prev, [topic.id]: e.target.value}))} className="w-full border border-gray-300 rounded-lg p-3 text-sm focus:outline-none focus:ring-2 focus:ring-orange-200 h-24" placeholder={`ã€Œ${topic.label}ã€ã«ã¤ã„ã¦ã€ãŠåº—ã¨ã—ã¦ã®ãŠã™ã™ã‚å•†å“ã‚„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒã‚ã‚Œã°å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`} /> </div> ))} </div> )} </div> {/* Bottom Close Button */} <div className="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4"> <button onClick={onClose} className="w-full bg-gray-200 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-300 transition-colors flex items-center justify-center gap-2" > <i data-lucide="x" className="w-5 h-5"></i> é–‰ã˜ã‚‹ </button> </div> </div> </div> ); }; const Header = ({ onCloseApp, onLogoClick, onOpenNgModal }) => ( <header className="bg-white shadow-sm sticky top-0 z-30 select-none"> <div className="max-w-2xl mx-auto px-4 py-3 flex items-center justify-between"> <div className="flex items-center gap-3 cursor-pointer active:scale-95 transition-transform" onClick={onLogoClick || onCloseApp}> <div className="w-11 h-11 bg-orange-100 rounded-full flex items-center justify-center text-orange-500"> <i data-lucide="paw-print" className="w-6 h-6"></i> </div> <div> <h1 className="text-xl font-bold text-gray-800 tracking-wide">sippofull</h1> <p className="text-[10px] text-gray-500 font-medium">çŠ¬çŒ«ãŠæ‚©ã¿ç›¸è«‡å®¤</p> </div> </div> <div className="flex items-center gap-2"> {/* NG Food Alert Button */} <button onClick={onOpenNgModal} className="bg-red-50 text-red-500 px-3 py-2 rounded-xl text-xs font-bold flex items-center gap-1.5 border border-red-100 hover:bg-red-100 hover:border-red-200 transition-all mr-1" > <i data-lucide="triangle-alert" className="w-4 h-4 fill-red-100"></i> <span className="hidden sm:inline">å±é™ºãªé£Ÿã¹ç‰©</span> <span className="sm:hidden">NGé£Ÿå“</span> </button> {/* LINE Inquiry Button */} <a href={LINE_URL} target="_blank" rel="noopener noreferrer" className="bg-[#06C755] text-white px-3 py-2 rounded-xl text-xs font-bold flex items-center gap-1.5 shadow-sm hover:opacity-90 hover:shadow-md transition-all mr-1 no-underline cursor-pointer" > <i data-lucide="message-circle" className="w-4 h-4 fill-current"></i> <span className="hidden sm:inline">ãŠå•åˆã›</span> </a> {/* Close Button (Replaces Reset Icon) */} <button onClick={onCloseApp} className="text-gray-500 bg-gray-100 hover:bg-gray-200 hover:text-gray-800 transition-colors px-3 py-2 rounded-xl font-bold flex items-center gap-1" > <i data-lucide="x" className="w-5 h-5"></i> <span className="hidden sm:inline">é–‰ã˜ã‚‹</span> </button> </div> </div> </header> ); const MessageBubble = ({ message }) => { const isUser = message.role === 'user'; const isShop = message.role === 'shop'; if (isShop) { return ( <div className="flex justify-start mb-6 animate-fade-in px-4"> <div className="w-10 h-10 rounded-full bg-green-100 flex items-center justify-center mr-3 flex-shrink-0 mt-1 border-2 border-white shadow-sm"> <i data-lucide="store" className="w-5 h-5 text-green-600"></i> </div> <div className="max-w-[85%] rounded-2xl rounded-tl-none px-5 py-4 shadow-md bg-green-50 text-gray-800 border border-green-200"> <div className="text-xs font-bold text-green-600 mb-2 flex items-center gap-1"> <i data-lucide="message-circle" className="w-3 h-3"></i> ãƒ¬ã‚¤ã‚ªãƒãƒŠåº—é•·ã‚ˆã‚Š </div> <div className="whitespace-pre-wrap text-base leading-relaxed"> {message.text} </div> <div className="mt-3 text-right"> <a href={LINE_URL} target="_blank" rel="noopener noreferrer" className="text-xs text-green-600 underline hover:text-green-800 font-bold" > LINEã§è©³ã—ãèã â†’ </a> </div> </div> </div> ); } return ( <div className={`flex ${isUser ? 'justify-end' : 'justify-start'} mb-6 animate-fade-in px-4`}> {!isUser && ( <div className="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center mr-3 flex-shrink-0 mt-1"> <i data-lucide="bot" className="w-6 h-6 text-orange-600"></i> </div> )} <div className={`max-w-[85%] rounded-2xl px-5 py-4 shadow-sm ${ isUser ? 'bg-orange-500 text-white rounded-tr-none' : 'bg-white text-gray-700 border border-gray-100 rounded-tl-none' }`}> <div className="whitespace-pre-wrap text-lg leading-relaxed"> {message.text} </div> {message.sources && message.sources.length > 0 && ( <div className="mt-4 pt-4 border-t border-white/20"> <p className={`text-sm font-bold mb-2 flex items-center gap-1 ${isUser ? 'text-orange-100' : 'text-gray-500'}`}> <i data-lucide="search" className="w-4 h-4"></i> å‚è€ƒæƒ…å ± </p> <ul className="space-y-2"> {message.sources.map((source, idx) => ( <li key={idx} className="text-sm truncate max-w-full"> <a href={source.uri} target="_blank" rel="noopener noreferrer" className={`${isUser ? 'text-white underline' : 'text-blue-500 hover:underline'} flex items-center gap-2`} > <span className={`w-1.5 h-1.5 rounded-full ${isUser ? 'bg-white' : 'bg-blue-400'}`}></span> {source.title || new URL(source.uri).hostname} </a> </li> ))} </ul> </div> )} </div> </div> ); }; const LoadingIndicator = () => ( <div className="flex justify-start mb-6 px-4"> <div className="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center mr-3 flex-shrink-0"> <i data-lucide="bot" className="w-6 h-6 text-orange-600"></i> </div> <div className="bg-white border border-gray-100 rounded-2xl rounded-tl-none px-5 py-4 shadow-sm flex items-center gap-2"> <span className="w-2.5 h-2.5 bg-orange-400 rounded-full animate-bounce-custom"></span> <span className="w-2.5 h-2.5 bg-orange-400 rounded-full animate-bounce-custom delay-100"></span> <span className="w-2.5 h-2.5 bg-orange-400 rounded-full animate-bounce-custom delay-200"></span> <span className="ml-2 text-sm text-gray-500">èª¿ã¹ã¦ã„ã¾ã™...</span> </div> </div> ); // --- Wizard Component --- const SelectionWizard = ({ onComplete }) => { const [step, setStep] = useState(1); const [selections, setSelections] = useState({ type: null, breed: null, age: null }); const handleTypeSelect = (typeId) => { setSelections(prev => ({ ...prev, type: typeId })); setStep(2); }; const handleBreedSelect = (breed) => { setSelections(prev => ({ ...prev, breed: breed })); setStep(3); }; const handleAgeSelect = (ageLabel) => { setSelections(prev => ({ ...prev, age: ageLabel })); setStep(4); }; return ( <div className="px-4 py-4 space-y-8 pb-20"> {/* Step 1: Dog or Cat */} <div className="animate-fade-in"> <h2 className="text-xl font-bold text-gray-700 mb-4 flex items-center"> <span className="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mr-3">1</span> {/* å¤‰æ›´ç®‡æ‰€: ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ */} ã©ã®å­ã®ã”ç›¸è«‡ã§ã™ã‹ï¼Ÿ </h2> <div className="grid grid-cols-2 gap-4"> {PET_TYPES.map(type => ( <button key={type.id} onClick={() => handleTypeSelect(type.id)} className={`p-6 rounded-2xl border-2 transition-all flex flex-col items-center gap-3 ${ selections.type === type.id ? 'border-orange-500 bg-orange-50 text-orange-600 shadow-md' : 'border-gray-100 bg-white text-gray-500 hover:border-orange-200 hover:bg-orange-50/50' }`} > <i data-lucide={type.icon} className="w-10 h-10"></i> <span className="text-xl font-bold">{type.label}</span> </button> ))} </div> </div> {/* Step 2: Breed */} {step >= 2 && ( <div className="animate-fade-in"> <h2 className="text-xl font-bold text-gray-700 mb-4 flex items-center"> <span className="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mr-3">2</span> ç¨®é¡ã¯ï¼Ÿ </h2> <div className="bg-white rounded-xl border border-gray-200 p-2 shadow-inner h-80 overflow-y-auto custom-scroll"> <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 p-2"> {BREEDS[selections.type].map(breed => ( <button key={breed} onClick={() => handleBreedSelect(breed)} className={`px-4 py-4 rounded-lg text-base font-medium text-left transition-colors truncate ${ selections.breed === breed ? 'bg-orange-500 text-white' : 'hover:bg-orange-50 text-gray-600' }`} > {breed} </button> ))} </div> </div> <p className="text-sm text-gray-400 mt-2 text-right">â€»ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦æ¢ã›ã¾ã™</p> </div> )} {/* Step 3: Age */} {step >= 3 && ( <div className="animate-fade-in"> <h2 className="text-xl font-bold text-gray-700 mb-4 flex items-center"> <span className="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mr-3">3</span> å¹´é½¢ã¯ï¼Ÿ </h2> <div className="grid grid-cols-3 gap-3"> {AGES.map(age => ( <button key={age.id} onClick={() => handleAgeSelect(age.label)} className={`p-3 py-4 rounded-xl border-2 transition-all text-center ${ selections.age === age.label ? 'bg-orange-500 text-white border-orange-500 shadow-md' : 'bg-white border-gray-100 hover:border-orange-300' }`} > <div className="text-lg font-bold mb-1">{age.label}</div> <div className={`text-sm ${selections.age === age.label ? 'text-orange-100' : 'text-gray-400'}`}>{age.sub}</div> </button> ))} </div> </div> )} {/* Step 4: Topic */} {step >= 4 && ( <div className="animate-fade-in pb-8"> <h2 className="text-xl font-bold text-gray-700 mb-4 flex items-center"> <span className="bg-orange-500 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm mr-3">4</span> ãŠæ‚©ã¿ã‚’é¸ã‚“ã§ãã ã•ã„ </h2> <div className="grid grid-cols-1 gap-3"> {TOPICS.map((topic) => ( <button key={topic.id} onClick={() => onComplete(selections, topic)} className="flex items-center justify-between p-5 bg-white border border-gray-200 rounded-xl hover:border-orange-400 hover:bg-orange-50/30 hover:shadow-md transition-all text-left group" > <span className="text-lg font-bold text-gray-700 group-hover:text-orange-600">{topic.label}</span> <i data-lucide="chevron-right" className="w-6 h-6 text-gray-300 group-hover:text-orange-500"></i> </button> ))} </div> </div> )} {/* Shop Link Banner */} <div className="mt-8 pt-6 border-t border-gray-200 animate-fade-in"> <a href={LINE_URL} target="_blank" rel="noopener noreferrer" className="block group" > <div className="bg-[#06C755] bg-opacity-10 border border-[#06C755] border-opacity-30 rounded-2xl p-4 flex items-center gap-4 hover:bg-opacity-20 transition-all cursor-pointer"> <div className="w-12 h-12 bg-[#06C755] rounded-full flex items-center justify-center flex-shrink-0 text-white"> <i data-lucide="message-circle" className="w-6 h-6 fill-current"></i> </div> <div> <p className="text-xs text-[#06C755] font-bold mb-0.5">çŠ¬çŒ«ã”ã¯ã‚“ã¨ãŠã‚„ã¤ã®ãŠåº— ãƒ¬ã‚¤ã‚ªãƒãƒŠ</p> <p className="text-gray-700 font-bold">å…¬å¼LINEã§ç›´æ¥ç›¸è«‡ã™ã‚‹</p> </div> <i data-lucide="external-link" className="w-5 h-5 text-[#06C755] ml-auto"></i> </div> </a> </div> </div> ); }; const App = () => { const { db, user, appId } = useFirebase(); const { comments, saveComment } = useShopComments(db, user, appId); const [input, setInput] = useState(""); const [messages, setMessages] = useState([]); const [isLoading, setIsLoading] = useState(false); const [showWizard, setShowWizard] = useState(true); const [isListening, setIsListening] = useState(false); const [adminModalOpen, setAdminModalOpen] = useState(false); const [ngModalOpen, setNgModalOpen] = useState(false); const [selectedPetType, setSelectedPetType] = useState(null); // Added for default NG filter // Admin trigger logic (5 clicks) const [logoClickCount, setLogoClickCount] = useState(0); const logoTimerRef = useRef(null); const messagesEndRef = useRef(null); const recognitionRef = useRef(null); useEffect(() => { if (window.lucide) window.lucide.createIcons(); scrollToBottom(); }, [messages, isLoading, showWizard]); // Logo Click Handler for Admin Access const handleLogoClick = () => { setLogoClickCount(prev => prev + 1); if (logoTimerRef.current) clearTimeout(logoTimerRef.current); logoTimerRef.current = setTimeout(() => { setLogoClickCount(0); }, 1000); // Reset if not clicked 5 times within 1 second if (logoClickCount >= 4) { // 4 previous + current = 5 setAdminModalOpen(true); setLogoClickCount(0); } }; // App Close / Reset Handler const handleAppClose = () => { // Try to close window (works in some LIFF/WebView contexts) try { window.close(); } catch (e) { // Ignore errors } // Always reset app state to initial setMessages([]); setShowWizard(true); setInput(""); setSelectedPetType(null); }; // Speech Recognition Setup useEffect(() => { if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) { const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; recognitionRef.current = new SpeechRecognition(); recognitionRef.current.continuous = false; recognitionRef.current.lang = 'ja-JP'; recognitionRef.current.interimResults = false; recognitionRef.current.onresult = (event) => { const transcript = event.results[0][0].transcript; setInput(prev => prev ? prev + " " + transcript : transcript); setIsListening(false); }; recognitionRef.current.onerror = (event) => { console.error("Speech recognition error", event.error); setIsListening(false); }; recognitionRef.current.onend = () => { setIsListening(false); }; } }, []); const toggleListening = () => { if (!recognitionRef.current) { alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚"); return; } if (isListening) { recognitionRef.current.stop(); setIsListening(false); } else { recognitionRef.current.start(); setIsListening(true); } }; const scrollToBottom = () => { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); }; const generateContent = async (prompt, topicId = null) => { const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL_NAME}:generateContent?key=${apiKey}`; const payload = { contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: ` ã‚ãªãŸã¯ã€Œsippofullã€ã¨ã„ã†çŠ¬çŒ«å°‚é–€ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ã§ã™ã€‚ è³ªå•è€…ã®ãƒšãƒƒãƒˆã®æƒ…å ±ï¼ˆç¨®é¡ã€å¹´é½¢ãªã©ï¼‰ã‚’è€ƒæ…®ã—ã¦ã€æœ€é©ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã—ã¦ãã ã•ã„ã€‚ ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼š 1. ç›¸æ‰‹ã®ãƒšãƒƒãƒˆï¼ˆä¾‹ï¼šã‚·ãƒ‹ã‚¢ã®æŸ´çŠ¬ï¼‰ã«åˆã‚ã›ãŸå£èª¿ã¨å†…å®¹ã‚’å¿ƒãŒã‘ã‚‹ã€‚ 2. çµè«–ã‚’å…ˆã«ã€ç†ç”±ã¯ç°¡æ½”ã«ã€‚ç®‡æ¡æ›¸ãã‚’æ´»ç”¨ã™ã‚‹ã€‚ 3. ä¸€èˆ¬è«–ã¨ã—ã¦å›ç­”ã—ã€ç—…æ°—ã®è¨ºæ–­ã¯ã—ãªã„ã€‚ã€Œç£åŒ»å¸«ã«ç›¸è«‡ã‚’ã€ã¨å¿…ãšæ·»ãˆã‚‹ã€‚ 4. è¦ªã—ã¿ã‚„ã™ãã€æ¸©ã‹ã„ãƒˆãƒ¼ãƒ³ã§ã€‚ æ—¥æœ¬èªã§å›ç­”ã—ã¦ãã ã•ã„ã€‚ ` }] }, tools: [{ google_search: {} }] }; const maxRetries = 3; let attempt = 0; let delay = 1000; while (attempt < maxRetries) { try { const response = await fetch(url, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) }); if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); return { data: await response.json(), topicId }; } catch (error) { attempt++; if (attempt >= maxRetries) throw error; await new Promise(r => setTimeout(r, delay)); delay *= 2; } } }; const handleWizardComplete = (selections, topic) => { setShowWizard(false); setSelectedPetType(selections.type); // Save pet type for filter const petDescription = `${selections.age}ã®${selections.breed}ï¼ˆ${selections.type === 'dog' ? 'çŠ¬' : 'çŒ«'}ï¼‰`; const fullQuery = `${petDescription}ã‚’é£¼ã£ã¦ã„ã¾ã™ã€‚${topic.query}`; const displayQuery = `${petDescription}ã«ã¤ã„ã¦ã®ç›¸è«‡\nã€ãŠæ‚©ã¿ã€‘${topic.label}`; handleSend(fullQuery, displayQuery, topic.id); }; const handleSend = async (apiText, displayText, topicId = null) => { const textToSend = apiText || input; const textToDisplay = displayText || input; if (!textToSend.trim() || isLoading) return; const userMsg = { role: 'user', text: textToDisplay }; setMessages(prev => [...prev, userMsg]); setInput(""); setIsLoading(true); try { const result = await generateContent(textToSend, topicId); const data = result.data; const candidate = data.candidates?.[0]; const aiText = candidate?.content?.parts?.[0]?.text || "å›ç­”ã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚"; const sources = candidate?.groundingMetadata?.groundingAttributions?.map(attr => ({ uri: attr.web?.uri, title: attr.web?.title })).filter(s => s.uri) || []; const uniqueSources = Array.from(new Map(sources.map(item => [item.uri, item])).values()); // Add AI Message setMessages(prev => [...prev, { role: 'model', text: aiText, sources: uniqueSources }]); // Add Shop Message if available for this topic if (topicId && comments[topicId] && comments[topicId].trim() !== "") { setTimeout(() => { setMessages(prev => [...prev, { role: 'shop', text: comments[topicId] }]); }, 800); // Slight delay for natural feel } } catch (error) { console.error(error); setMessages(prev => [...prev, { role: 'model', text: "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚", sources: [] }]); } finally { setIsLoading(false); } }; return ( <div className="flex flex-col h-screen bg-gray-50 max-w-2xl mx-auto shadow-2xl relative overflow-hidden"> <Header onCloseApp={handleAppClose} onLogoClick={handleLogoClick} onOpenNgModal={() => setNgModalOpen(true)} /> <main className="flex-1 overflow-y-auto pb-36"> {showWizard ? ( <SelectionWizard onComplete={handleWizardComplete} /> ) : ( <> <div className="bg-orange-50 border-l-4 border-orange-400 p-4 text-sm text-orange-800 mb-6 rounded-r mx-4 mt-6"> <p className="font-bold mb-1 flex items-center gap-2"><i data-lucide="alert-circle" className="w-4 h-4"></i> ã”åˆ©ç”¨ä¸Šã®æ³¨æ„</p> <p>AIã«ã‚ˆã‚‹å›ç­”ã¯å‚è€ƒæƒ…å ±ã§ã™ã€‚ç·Šæ€¥æ™‚ã‚„ä½“èª¿ä¸è‰¯æ™‚ã¯ã€å¿…ãšå‹•ç‰©ç—…é™¢ã¸ã”ç›¸è«‡ãã ã•ã„ã€‚</p> </div> {messages.map((msg, index) => ( <MessageBubble key={index} message={msg} /> ))} {isLoading && <LoadingIndicator />} </> )} <div ref={messagesEndRef} /> </main> {/* Chat Input Area */} {!showWizard && ( <div className="absolute bottom-0 left-0 right-0 bg-white border-t border-gray-100 p-4 pb-8 z-20"> <div className="flex gap-3 items-end"> <button onClick={toggleListening} className={`w-14 h-14 rounded-full flex items-center justify-center transition-all flex-shrink-0 ${ isListening ? 'bg-red-500 text-white animate-pulse-ring' : 'bg-gray-100 text-gray-500 hover:bg-gray-200' }`} title="éŸ³å£°å…¥åŠ›" > {isListening ? ( <i data-lucide="mic-off" className="w-7 h-7"></i> ) : ( <i data-lucide="mic" className="w-7 h-7"></i> )} </button> <textarea value={input} onChange={(e) => setInput(e.target.value)} placeholder={isListening ? "ãŠè©±ã—ãã ã•ã„..." : "è¿½åŠ ã§è³ªå•ã™ã‚‹..."} className="flex-1 bg-gray-100 text-gray-800 rounded-2xl pl-5 pr-4 py-4 focus:outline-none focus:ring-2 focus:ring-orange-200 resize-none h-14 text-lg" onKeyDown={(e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); } }} /> <button onClick={() => handleSend()} disabled={!input.trim() || isLoading} className={`w-14 h-14 rounded-full flex items-center justify-center transition-all flex-shrink-0 ${ !input.trim() || isLoading ? 'bg-gray-200 text-gray-400' : 'bg-orange-500 text-white shadow-lg hover:bg-orange-600' }`} > <i data-lucide="send" className="w-7 h-7 ml-0.5"></i> </button> </div> {isListening && <p className="text-center text-sm text-red-500 mt-2 font-bold animate-pulse">éŸ³å£°èªè­˜ä¸­...</p>} </div> )} <NgFoodModal isOpen={ngModalOpen} onClose={() => setNgModalOpen(false)} defaultFilter={selectedPetType || 'all'} /> <AdminModal isOpen={adminModalOpen} onClose={() => setAdminModalOpen(false)} comments={comments} onSave={saveComment} /> </div> ); }; const root = ReactDOM.createRoot(document.getElementById('root')); root.render(<App />); </script> </body> </html>
